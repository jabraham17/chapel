#!/bin/sh 

TESTNAME=$1
OUTFILE=$2
TMPFILE=$OUTFILE.prediff.tmp

# filter out line numbers
sed -E 's/\.chpl:[0-9]*:/\.chpl:n:/' < $OUTFILE > $TMPFILE
cat $TMPFILE > $OUTFILE

# filter out sync/single
sed -E 's/sync|single/SYNCSINGLE/' < $OUTFILE > $TMPFILE
cat $TMPFILE > $OUTFILE

# filter return intent
sed -E "s/by .+ is unstable/by RETINTENT is unstable/" < $OUTFILE > $TMPFILE
cat $TMPFILE > $OUTFILE

# TODO: this can be removed once the sync/single deprecations are gone
# filter out the deprecation warnings from implicit read/write
sed -E '/^.+deprecated.+$/d' < $OUTFILE > $TMPFILE
cat $TMPFILE > $OUTFILE


rm $TMPFILE
